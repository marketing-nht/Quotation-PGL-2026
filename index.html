<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>PGL AI Pricing Assistant</title>
  <meta name="description" content="Trợ lý AI tra cứu báo giá thử nghiệm Phúc Gia Lab">
  
  <!-- Tailwind CSS -->
  <script src="https://cdn.tailwindcss.com"></script>
  
  <!-- Google Fonts -->
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
  
  <!-- CSS Styles -->
  <style>
    body {
      font-family: 'Inter', sans-serif;
      background-color: #f8fafc;
    }
    .animate-fadeIn {
      animation: fadeIn 0.4s cubic-bezier(0.16, 1, 0.3, 1) forwards;
    }
    .animate-slideUp {
      animation: slideUp 0.4s cubic-bezier(0.16, 1, 0.3, 1) forwards;
    }
    @keyframes fadeIn {
      from { opacity: 0; }
      to { opacity: 1; }
    }
    @keyframes slideUp {
      from { opacity: 0; transform: translateY(20px); }
      to { opacity: 1; transform: translateY(0); }
    }
    
    /* Print Styles */
    @media print {
      body { background-color: white; }
      aside, header, form, .no-print { display: none !important; }
      main { margin: 0 !important; padding: 0 !important; }
      .print-only { display: block !important; }
      .shadow-sm, .shadow-md, .shadow-lg { box-shadow: none !important; }
      .border { border: 1px solid #ddd !important; }
    }
    
    /* Custom Scrollbar */
    ::-webkit-scrollbar { width: 8px; }
    ::-webkit-scrollbar-track { background: #f1f5f9; }
    ::-webkit-scrollbar-thumb { background: #cbd5e1; border-radius: 4px; }
    ::-webkit-scrollbar-thumb:hover { background: #94a3b8; }
  </style>

  <!-- Import Map - FIX: Cập nhật @google/generative-ai lên phiên bản mới nhất (0.21.0) -->
  <script type="importmap">
  {
    "imports": {
      "react": "https://esm.sh/react@19.0.0",
      "react-dom": "https://esm.sh/react-dom@19.0.0",
      "react-dom/client": "https://esm.sh/react-dom@19.0.0/client",
      "@google/generative-ai": "https://esm.sh/@google/generative-ai@0.21.0",
      "lucide-react": "https://esm.sh/lucide-react@0.460.0?external=react",
      "htm": "https://esm.sh/htm@3.1.1"
    }
  }
  </script>
</head>
<body>
  <div id="root"></div>

  <script type="module">
    import React, { useState, useEffect } from 'react';
    import ReactDOM from 'react-dom/client';
    import { GoogleGenerativeAI } from '@google/generative-ai';
    import { 
      Search, Calculator, FileText, Settings, Info, Loader2, AlertCircle, Copy, Check, Key, ShieldCheck, X, Printer
    } from 'lucide-react';
    import htm from 'htm';

    const html = htm.bind(React.createElement);

    // --- CONFIGURATION ---
    const RUNTIME_API_KEY = ""; 

    // --- DATA CONTEXT ---
    const PGL_PRICING_CONTEXT = `
[DỮ LIỆU BÁO GIÁ TỪ PDF - SỐ: 26010201/PGL-BG - NGÀY: 02/01/2026]

1. CHỨNG NHẬN HỢP QUY (QCVN 9:2012/BKHCN - Thiết bị gia dụng):
Điều hòa thường: 2.000.000 VNĐ (77 USD).
Điều hòa Multi (1 mẹ 2 con): 3.000.000 VNĐ (115 USD). Thêm 1 mặt lạnh cộng thêm 1.000.000 VNĐ.
Đồng giá 2.000.000 VNĐ (77 USD) cho các sản phẩm: Tủ lạnh, Tủ giữ lạnh thương mại, Lò vi sóng, Bếp điện, Máy xay sinh tố, Máy xay thịt, Máy ép trái cây, Máy đánh trứng, Máy sấy tóc, Bình nước nóng tức thời, Máy giặt, Máy khoan tay, Máy hút bụi.
Phí cấp lại bản gốc tiếp theo: 500.000 VNĐ.

2. CHỨNG NHẬN HỢP QUY (QCVN 4:2009/BKHCN & QCVN 25:2025/BKHCN):
Phương thức 1 (QCVN 25:2025 - Ổ cắm/Phích cắm/Dây nguồn): 5.000.000 VNĐ.
Phương thức 5 (Đánh giá nhà máy QCVN 4 & 25):
Trong nước: Đánh giá quá trình SX: 30.000.000 VNĐ; Giám sát: 15.000.000 VNĐ.
Nước ngoài: Đánh giá quá trình SX: 50.000.000 VNĐ; Giám sát: 25.000.000 VNĐ.
Phương thức 7 (Theo lô hàng QCVN 4 - Safety):
Lô 1-5 model: 3.000.000 VNĐ.
Lô 6-10 model: 4.000.000 VNĐ.
Lô 11-15 model: 5.000.000 VNĐ.
Lô >15 model: 6.000.000 VNĐ.
Phương thức 7 (Theo lô hàng QCVN 25:2025 - Ổ cắm/Phích cắm):
Lô 1-5 model: 6.000.000 VNĐ.
Lô 6-10 model: 7.000.000 VNĐ.
Lô 11-15 model: 8.000.000 VNĐ.
Lô >15 model: 9.000.000 VNĐ.

3. THỬ NGHIỆM HIỆU SUẤT NĂNG LƯỢNG (VNEEP):
Điều hòa (Non-Inverter <= 60.000 BTU): 15.000.000 VNĐ.
Điều hòa (Inverter <= 60.000 BTU): 20.000.000 VNĐ.
Tủ lạnh, Tủ đông, Tủ mát, Tủ giữ lạnh thương mại: 9.000.000 VNĐ.
Bếp từ/Hồng ngoại (1 vùng nấu): 3.000.000 VNĐ.
Bếp từ/Hồng ngoại (2-3 vùng nấu): 5.000.000 VNĐ.
Bếp từ/Hồng ngoại (4-5 vùng nấu): 7.000.000 VNĐ.
Quạt điện: 2.000.000 VNĐ (<50W) hoặc 3.000.000 VNĐ (>=50W).
Quạt trần: 4.000.000 VNĐ.
Đèn LED: 4.000.000 VNĐ.
Đèn đường LED: 7.000.000 VNĐ (<=100W) đến 13.000.000 VNĐ (>300W).
Máy giặt (Cửa trên/ngang): 2.500.000 VNĐ (<=10kg); 3.500.000 VNĐ (>10kg).
Nồi cơm điện: 2.000.000 VNĐ.
Máy tính để bàn, Máy tính xách tay (Laptop), Máy tính bảng: 3.000.000 VNĐ.
Màn hình máy tính: 1.500.000 VNĐ (<=40 inch); 2.500.000 VNĐ (>40 inch).
Tivi (Máy thu hình): 3.500.000 VNĐ.
Bình đun nước nóng dự trữ: 5.000.000 VNĐ (<70L); 7.000.000 VNĐ (>=70L).

4. THỬ NGHIỆM HỢP QUY (QCVN 9:2012/BKHCN - EMC):
Điều hòa 1 chiều (<24000 BTU): 13.000.000 VNĐ.
Điều hòa 2 chiều hoặc >=24000 BTU: 15.000.000 VNĐ.
Điều hòa Multi: 15.000.000 VNĐ (+2.000.000 VNĐ/mặt lạnh).
Tủ lạnh, Tủ mát: 9.000.000 VNĐ.
Lò vi sóng: 10.000.000 VNĐ.
Bếp điện (1 vùng): 6.000.000 VNĐ; (>=2 vùng): 7.000.000 VNĐ.
Máy xay, ép, đánh trứng, máy sấy tóc, máy khoan: 5.000.000 VNĐ.
Máy hút bụi (1 động cơ): 5.000.000 VNĐ; (>=2 động cơ): 7.000.000 VNĐ.
Máy giặt: 9.000.000 VNĐ.

5. THỬ NGHIỆM AN TOÀN ĐIỆN (QCVN 4:2009 & QCVN 132:2022):
Gia dụng (QCVN 4:2009):
Bình nóng lạnh, Máy sấy tóc, Ấm siêu tốc, Nồi cơm, Quạt, Bàn là, Lò nướng: Lần đầu 6.000.000 VNĐ; Lần 2 trở đi 2.000.000 VNĐ.
Lò vi sóng: Lần đầu 8.000.000 VNĐ.
Thiết bị CNTT & Viễn thông (QCVN 132:2022 - IEC 62368):
Gói cơ bản (Thân máy + 1 Adapter): 23.000.000 VNĐ.
Phụ phí Adapter tích hợp thêm: +11.500.000 VNĐ.
Phụ phí Adapter rời thêm: +5.000.000 - 7.000.000 VNĐ.
Thiết bị chứa chất lỏng có áp suất: +20.000.000 VNĐ.

6. THỬ NGHIỆM ĐÈN LED (QCVN 19:2019):
Trọn gói QCVN 19 (ES+EMI+EMS+PBS): 25.000.000 VNĐ (chưa IP) hoặc 27.000.000 VNĐ (có IP).
Thử lẻ: ES (5M), EMI (6M), EMS (9M), PBS (5M).

7. THỬ NGHIỆM VIỄN THÔNG (CẬP NHẬT 2026):
QCVN 134:2024/BTTTT (Điện thoại & Tablet):
Điện thoại 3G+4G (Không CA): 860.000.000 VNĐ.
Điện thoại 3G+4G (Có CA): 1.040.000.000 VNĐ.
Điện thoại 3G+4G+5G (Không CA, MIMO): 1.125.000.000 VNĐ (Giảm 20% khi combo).
Điện thoại 3G+4G+5G (Có MIMO, CA): 1.300.000.000 VNĐ (Giảm 20% khi combo).
Máy tính bảng/Laptop (Chỉ Wifi): 290.000.000 VNĐ.
Máy tính bảng (Có 4G/5G): Từ 435.000.000 VNĐ đến 980.000.000 VNĐ tùy cấu hình CA/MIMO.
Các QCVN khác:
QCVN 117:2023 (GSM/WCDMA): 12M. (LTE): 18M. (2 công nghệ): 26M. (3 công nghệ): 34M.
QCVN 18:2022 (Non-5G): 7M. (5G - Combo QCVN 18, 127, 129): 500.000.000 VNĐ.
QCVN 136:2025 (Mới): 25.000.000 VNĐ.
Wifi (QCVN 54, 65): 7M - 10M.

8. THỬ NGHIỆM Ổ CẮM, PHÍCH CẮM (QCVN 25:2025):
Thử nghiệm trọn gói để chứng nhận hợp quy: 18.000.000 VNĐ (15 ngày).
Thử nghiệm theo tiêu chuẩn yêu cầu: 8.000.000 VNĐ.

9. PIN LITHIUM (QCVN 101:2020):
Gói pin (Pack): 8.000.000 VNĐ (Cần 22 mẫu).
Tế bào pin (Cell): 8.000.000 VNĐ (Cần 38 mẫu).
Trọn gói (Pack + 1 Cell): 16.000.000 VNĐ.

LƯU Ý CHUNG TỪ FILE:
Giá chưa bao gồm VAT (5%).
Hiệu lực báo giá: 30 ngày từ 02/01/2026.
Phí thử nghiệm nhanh (gấp): Nhân 1.5 lần giá cơ sở.
Phí thử mẫu không đạt (Fail): Hỗ trợ thu 50% phí.
`;

    // --- GEMINI SERVICE ---
    const searchPricing = async (query, userApiKey) => {
      const finalKey = RUNTIME_API_KEY || userApiKey;
      if (!finalKey) throw new Error("Vui lòng nhập API Key để tiếp tục.");

      const genAI = new GoogleGenerativeAI(finalKey);
      
      const model = genAI.getGenerativeModel({ 
        model: "gemini-1.5-flash",
        generationConfig: {
          responseMimeType: "application/json",
        }
      });

      const prompt = `Bạn là Trợ lý AI chuyên trách về dữ liệu báo giá của Công ty Cổ phần Phòng thử nghiệm Phúc Gia (PGL). 
        Hãy tra cứu báo giá cho sản phẩm: "${query}" dựa trên dữ liệu dưới đây.

        NGUYÊN TẮC:
        1. Chính xác tuyệt đối theo [DỮ LIỆU BÁO GIÁ].
        2. Phân biệt phí "Chứng nhận" và "Thử nghiệm".
        3. Nếu tìm thấy nhiều loại phí, hãy liệt kê hết.
        4. Trả về JSON array thuần túy, không markdown.
        
        DỮ LIỆU BÁO GIÁ:
        ${PGL_PRICING_CONTEXT}

        Output JSON format:
        [
          {
            "category": "Loại phí (Thử nghiệm/Chứng nhận)",
            "regulation": "QCVN tương ứng",
            "product_name": "Tên sản phẩm chi tiết",
            "price_vnd": 1000000,
            "price_usd": 0,
            "execution_time": "Thời gian (nếu có)",
            "sample_required": "Số lượng mẫu (nếu có)",
            "notes": "Ghi chú thêm"
          }
        ]
      `;

      try {
        const result = await model.generateContent(prompt);
        const text = result.response.text(); 
        return JSON.parse(text);
      } catch (err) {
        console.error("AI Error:", err);
        // Cải thiện thông báo lỗi để người dùng dễ hiểu hơn
        if (err.message.includes('404') || err.message.includes('not found')) {
            throw new Error("Lỗi kết nối Model AI (404). Vui lòng thử lại sau hoặc kiểm tra quyền API Key.");
        }
        throw new Error(err.message || "Không thể xử lý yêu cầu. Vui lòng thử lại sau.");
      }
    };

    // --- UI COMPONENTS ---
    const NavItem = ({ icon, label, active, onClick }) => html`
      <button 
        onClick=${onClick}
        className=${`flex w-full items-center gap-3 px-4 py-3 rounded-xl transition-all ${active ? 'bg-blue-50 text-blue-600 font-bold shadow-sm ring-1 ring-blue-100' : 'text-slate-500 hover:bg-slate-50 hover:text-slate-900'}`}
      >
        <${icon} size=${18} />
        <span className="text-sm text-left flex-1">${label}</span>
      </button>
    `;

    const DetailItem = ({ label, value }) => html`
      <div className="space-y-1">
        <span className="text-[10px] font-bold text-slate-400 uppercase tracking-wider">${label}</span>
        <p className="text-sm font-semibold text-slate-700">${value}</p>
      </div>
    `;

    const PricingCard = ({ item, isCopied, onCopy }) => html`
      <div className="bg-white rounded-3xl border border-slate-200 shadow-sm overflow-hidden hover:shadow-md transition-shadow group animate-slideUp break-inside-avoid">
        <div className="p-6 md:p-8">
          <div className="flex flex-col md:flex-row md:items-start justify-between gap-4 mb-6">
            <div className="space-y-1">
              <span className="inline-block px-3 py-1 bg-blue-100 text-blue-600 text-[10px] font-bold uppercase rounded-full tracking-wider mb-2">
                ${item.category}
              </span>
              <h3 className="text-xl font-bold text-slate-800 leading-tight">${item.product_name}</h3>
              <p className="text-sm text-slate-500 flex items-center gap-2">
                <${FileText} size=${14} /> ${item.regulation}
              </p>
            </div>
            
            <div className="flex flex-col items-end gap-1">
              <div className="text-2xl font-black text-blue-600">
                ${item.price_vnd?.toLocaleString('vi-VN')} VNĐ
              </div>
              ${item.price_usd > 0 && html`
                <div className="text-sm font-medium text-slate-400">
                  ~ ${item.price_usd} USD
                </div>
              `}
            </div>
          </div>

          <div className="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 gap-6 py-6 border-y border-slate-100">
            <${DetailItem} label="Thời gian thực hiện" value=${item.execution_time || "Liên hệ PGL"} />
            <${DetailItem} label="Mẫu yêu cầu" value=${item.sample_required || "N/A"} />
            <${DetailItem} label="VAT (5%)" value="Chưa bao gồm" />
          </div>

          <div className="mt-6">
            <h4 className="text-xs font-bold text-slate-400 uppercase tracking-widest mb-2">Ghi chú chi tiết</h4>
            <p className="text-sm text-slate-600 leading-relaxed bg-slate-50 p-4 rounded-2xl italic">
              "${item.notes}"
            </p>
          </div>
        </div>

        <div className="px-6 py-4 bg-slate-50 border-t border-slate-100 flex items-center justify-between no-print">
          <span className="text-[10px] text-slate-400 font-medium">Báo giá 2026 • PGL Lab</span>
          <button
            onClick=${onCopy}
            className=${`flex items-center gap-2 text-xs font-bold transition-all px-4 py-2 rounded-full border ${isCopied ? 'bg-green-100 border-green-200 text-green-600' : 'bg-white border-slate-200 text-slate-600 hover:border-slate-300'}`}
          >
            <${isCopied ? Check : Copy} size=${14} />
            ${isCopied ? 'Đã sao chép' : 'Copy JSON'}
          </button>
        </div>
      </div>
    `;

    const ApiKeyModal = ({ isOpen, onClose, onSave }) => {
      const [key, setKey] = useState('');

      if (!isOpen) return null;

      return html`
        <div className="fixed inset-0 bg-black/50 backdrop-blur-sm z-50 flex items-center justify-center p-4 animate-fadeIn no-print">
          <div className="bg-white rounded-2xl shadow-2xl max-w-md w-full p-6 animate-slideUp">
            <div className="flex items-center justify-between mb-4">
              <h3 className="text-lg font-bold text-slate-800 flex items-center gap-2">
                <${Key} size=${20} className="text-amber-500" />
                Cấu hình API Key
              </h3>
              <button onClick=${onClose} className="text-slate-400 hover:text-slate-600"><${X} size=${20}/></button>
            </div>
            
            <p className="text-sm text-slate-500 mb-4">
              Để sử dụng ứng dụng này, bạn cần cung cấp Google Gemini API Key. Key của bạn sẽ chỉ được lưu trên trình duyệt này.
            </p>

            <input
              type="password"
              placeholder="Dán API Key của bạn vào đây (AIza...)"
              className="w-full p-3 border border-slate-300 rounded-xl mb-4 focus:ring-2 focus:ring-blue-500 focus:border-blue-500 outline-none"
              value=${key}
              onChange=${e => setKey(e.target.value)}
            />

            <div className="flex gap-2 justify-end">
              <button onClick=${onClose} className="px-4 py-2 text-slate-600 font-medium hover:bg-slate-100 rounded-lg">Đóng</button>
              <button 
                onClick=${() => onSave(key)}
                disabled=${!key.trim()}
                className="px-4 py-2 bg-blue-600 text-white font-medium rounded-lg hover:bg-blue-700 disabled:opacity-50"
              >
                Lưu & Tiếp tục
              </button>
            </div>
            
            <div className="mt-4 pt-4 border-t border-slate-100 text-xs text-slate-400 text-center">
              Chưa có key? <a href="https://aistudio.google.com/app/apikey" target="_blank" className="text-blue-600 hover:underline">Lấy miễn phí tại Google AI Studio</a>
            </div>
          </div>
        </div>
      `;
    };

    const App = () => {
      const [state, setState] = useState({
        isSearching: false,
        query: '',
        results: [],
        error: null,
      });
      const [copiedIndex, setCopiedIndex] = useState(null);
      const [userApiKey, setUserApiKey] = useState(() => localStorage.getItem('pgl_gemini_key') || '');
      const [isKeyModalOpen, setKeyModalOpen] = useState(false);
      const [activeTab, setActiveTab] = useState('search');

      // Check if runtime key is available (mostly for dev env)
      const hasRuntimeKey = !!RUNTIME_API_KEY;

      const handleSearch = async (e) => {
        if (e) e.preventDefault();
        
        if (!hasRuntimeKey && !userApiKey) {
          setKeyModalOpen(true);
          return;
        }

        if (!state.query.trim()) return;

        setState(prev => ({ ...prev, isSearching: true, error: null }));
        try {
          const data = await searchPricing(state.query, userApiKey);
          setState(prev => ({ ...prev, results: data, isSearching: false }));
        } catch (err) {
          console.error(err);
          let errMsg = err.message || 'Đã có lỗi xảy ra khi tra cứu.';
          setState(prev => ({ ...prev, error: errMsg, isSearching: false }));
        }
      };

      const copyToClipboard = (json, index) => {
        const textArea = document.createElement("textarea");
        textArea.value = json;
        document.body.appendChild(textArea);
        textArea.select();
        try {
          document.execCommand('copy');
          setCopiedIndex(index);
          setTimeout(() => setCopiedIndex(null), 2000);
        } catch (err) {
          console.error('Fallback: Oops, unable to copy', err);
        }
        document.body.removeChild(textArea);
      };

      const saveApiKey = (key) => {
        localStorage.setItem('pgl_gemini_key', key);
        setUserApiKey(key);
        setKeyModalOpen(false);
        if (state.query) {
           setTimeout(() => handleSearch(), 100);
        }
      };

      const clearApiKey = () => {
        localStorage.removeItem('pgl_gemini_key');
        setUserApiKey('');
        alert('Đã xóa API Key khỏi trình duyệt.');
      };

      // Handle Print
      const handlePrint = () => {
        window.print();
      }

      return html`
        <div className="min-h-screen flex flex-col md:flex-row bg-slate-50 text-slate-900 font-sans">
          <!-- Sidebar -->
          <aside className="w-full md:w-64 bg-white border-r border-slate-200 p-6 flex flex-col gap-8 md:fixed md:h-full z-20 no-print">
            <div className="flex items-center gap-3">
              <div className="w-10 h-10 bg-blue-600 rounded-lg flex items-center justify-center text-white shadow-lg shadow-blue-200">
                <${Calculator} size=${24} />
              </div>
              <div>
                <h1 className="font-bold text-lg text-slate-800 tracking-tight">PGL AI</h1>
                <p className="text-xs text-slate-500 font-medium">Pricing Assistant v2.3</p>
              </div>
            </div>

            <nav className="flex flex-col gap-2">
              <${NavItem} icon=${Search} label="Tra cứu báo giá" active=${activeTab === 'search'} onClick=${() => setActiveTab('search')} />
              <${NavItem} icon=${FileText} label="Lịch sử (Demo)" active=${activeTab === 'history'} onClick=${() => setActiveTab('history')} />
              <${NavItem} icon=${Settings} label="Cấu hình API" active=${activeTab === 'settings'} onClick=${() => setKeyModalOpen(true)} />
            </nav>

            <div className="mt-auto bg-blue-50 p-4 rounded-xl border border-blue-100">
              <h3 className="text-xs font-bold text-blue-800 mb-2 uppercase tracking-wider flex items-center gap-1">
                <${Info} size=${12}/> Trạng thái hệ thống
              </h3>
              <div className="flex items-center gap-2 mb-2">
                <div className=${`w-2 h-2 rounded-full ${hasRuntimeKey || userApiKey ? 'bg-green-500' : 'bg-red-500'}`}></div>
                <span className="text-xs text-blue-900 font-medium">
                  ${hasRuntimeKey ? 'Hệ thống (Sanbox)' : (userApiKey ? 'Đã nhập Key cá nhân' : 'Chưa có API Key')}
                </span>
              </div>
              ${!hasRuntimeKey && userApiKey && html`
                <button onClick=${clearApiKey} className="text-[10px] text-red-500 underline hover:text-red-700">Xóa Key</button>
              `}
            </div>
          </aside>

          <!-- Main Content -->
          <main className="flex-1 md:ml-64 min-h-screen flex flex-col print:ml-0">
            <!-- Header -->
            <header className="h-16 bg-white/80 backdrop-blur-md border-b border-slate-200 px-6 md:px-8 flex items-center justify-between sticky top-0 z-10 no-print">
              <h2 className="text-sm font-semibold text-slate-500 uppercase tracking-wider flex items-center gap-2">
                <span className="w-1.5 h-1.5 rounded-full bg-slate-300"></span>
                Trung tâm dữ liệu PGL
              </h2>
              <div className="flex items-center gap-4">
                <span className="hidden sm:inline-block text-xs font-medium text-slate-500 bg-slate-100 px-3 py-1 rounded-full">
                  Cập nhật: 02/01/2026
                </span>
                <div className="w-8 h-8 rounded-full bg-gradient-to-tr from-blue-500 to-purple-500 shadow-md"></div>
              </div>
            </header>

            <div className="max-w-5xl mx-auto w-full p-6 md:p-8 flex-1">
              ${activeTab === 'search' ? html`
                <div className="animate-fadeIn">
                  <div className="mb-10 text-center md:text-left no-print">
                    <h1 className="text-3xl md:text-4xl font-extrabold text-slate-800 mb-4 tracking-tight">Tra cứu báo giá dịch vụ</h1>
                    <p className="text-slate-500 max-w-2xl leading-relaxed text-lg">
                      Nhập tên thiết bị hoặc tiêu chuẩn (QCVN) để AI trích xuất thông tin chính xác từ bảng giá niêm yết 2026.
                    </p>

                    <form onSubmit=${handleSearch} className="mt-8 flex flex-col sm:flex-row gap-3 max-w-3xl">
                      <div className="relative flex-1 group">
                        <${Search} className="absolute left-4 top-1/2 -translate-y-1/2 text-slate-400 group-focus-within:text-blue-500 transition-colors" size=${22} />
                        <input
                          type="text"
                          placeholder="Ví dụ: Smartphone 5G, Pin Lithium, Đèn LED..."
                          className="w-full pl-12 pr-4 py-4 bg-white border-2 border-slate-200 rounded-2xl focus:outline-none focus:border-blue-500 focus:shadow-lg focus:shadow-blue-50 transition-all text-slate-800 text-lg shadow-sm placeholder:text-slate-300"
                          value=${state.query}
                          onChange=${(e) => setState(prev => ({ ...prev, query: e.target.value }))}
                        />
                      </div>
                      <button
                        type="submit"
                        disabled=${state.isSearching || !state.query.trim()}
                        className="px-8 py-4 bg-blue-600 hover:bg-blue-700 disabled:bg-slate-300 disabled:cursor-not-allowed text-white font-bold rounded-2xl shadow-lg shadow-blue-200 hover:shadow-blue-300 hover:-translate-y-0.5 transition-all flex items-center justify-center gap-2 min-w-[160px]"
                      >
                        ${state.isSearching ? html`<${Loader2} className="animate-spin" size=${24} />` : html`Tra cứu <span className="ml-1">→</span>`}
                      </button>
                    </form>
                  </div>

                  <!-- Print Header (Only shows when printing) -->
                  <div className="hidden print-only mb-8 text-center border-b pb-4">
                     <h1 className="text-2xl font-bold uppercase mb-2">Bảng báo giá dịch vụ PGL</h1>
                     <p>Ngày tra cứu: ${new Date().toLocaleDateString('vi-VN')}</p>
                     <p>Từ khóa: "${state.query}"</p>
                  </div>

                  ${state.error && html`
                    <div className="mb-8 p-4 bg-red-50 border border-red-200 rounded-xl flex items-start gap-3 text-red-700 animate-fadeIn no-print">
                      <${AlertCircle} size=${20} className="shrink-0 mt-0.5" />
                      <div>
                        <p className="font-bold">Đã xảy ra lỗi</p>
                        <p className="text-sm">${state.error}</p>
                      </div>
                    </div>
                  `}

                  ${state.isSearching ? html`
                    <div className="py-20 flex flex-col items-center justify-center text-slate-400 gap-6 animate-fadeIn no-print">
                      <div className="relative">
                        <div className="w-16 h-16 border-4 border-blue-100 border-t-blue-500 rounded-full animate-spin"></div>
                        <div className="absolute inset-0 flex items-center justify-center">
                          <${Calculator} size=${24} className="text-blue-500" />
                        </div>
                      </div>
                      <p className="text-sm font-medium animate-pulse">Đang phân tích dữ liệu báo giá...</p>
                    </div>
                  ` : html`
                    <div>
                       ${state.results.length > 0 && html`
                         <div className="flex justify-end mb-4 no-print animate-fadeIn">
                            <button onClick=${handlePrint} className="flex items-center gap-2 text-sm font-bold text-slate-500 hover:text-blue-600 bg-white hover:bg-blue-50 px-4 py-2 rounded-lg border border-slate-200 transition-colors">
                              <${Printer} size=${16} /> In kết quả
                            </button>
                         </div>
                       `}
                    
                      <div className="grid grid-cols-1 gap-6 pb-20">
                        ${state.results.length > 0 ? state.results.map((item, idx) => html`
                          <${PricingCard}
                            key=${idx}
                            item=${item}
                            isCopied=${copiedIndex === idx}
                            onCopy=${() => copyToClipboard(JSON.stringify(item, null, 2), idx)}
                          />
                        `) : (state.query && !state.error && html`
                          <div className="py-20 text-center text-slate-400 bg-white rounded-3xl border-2 border-dashed border-slate-200 animate-fadeIn no-print">
                            <${ShieldCheck} size=${64} className="mx-auto mb-4 text-slate-200" />
                            <p className="text-xl font-bold text-slate-600 mb-2">Không tìm thấy kết quả</p>
                            <p className="text-sm text-slate-400">Hãy thử từ khóa khác như "Điều hòa", "Máy giặt", "QCVN 117".</p>
                          </div>
                        `)}
                      </div>
                    </div>
                  `}
                </div>
              ` : html`
                <div className="flex flex-col items-center justify-center h-[60vh] text-slate-400 animate-fadeIn no-print">
                  <div className="w-20 h-20 bg-slate-100 rounded-full flex items-center justify-center mb-4">
                    <${Settings} size=${32} />
                  </div>
                  <h3 className="text-xl font-bold text-slate-600">Tính năng đang phát triển</h3>
                  <p className="text-sm">Vui lòng quay lại tab "Tra cứu báo giá"</p>
                </div>
              `}
            </div>
          </main>

          <${ApiKeyModal} 
            isOpen=${isKeyModalOpen} 
            onClose=${() => setKeyModalOpen(false)}
            onSave=${saveApiKey}
          />
        </div>
      `;
    };

    const root = ReactDOM.createRoot(document.getElementById('root'));
    root.render(html`<${App} />`);
  </script>
</body>
</html>
