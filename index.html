<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>PGL Pricing Assistant 2026</title>
  <meta name="description" content="Tra cứu báo giá Phúc Gia Lab 2026">
  
  <script src="https://cdn.tailwindcss.com"></script>
  
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
  
  <style>
    body { font-family: 'Inter', sans-serif; background-color: #f8fafc; }
    .animate-fadeIn { animation: fadeIn 0.5s ease-out forwards; }
    @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
    
    /* Error Banner Style */
    #error-banner { display: none; padding: 1rem; background: #fee2e2; border-bottom: 2px solid #ef4444; color: #b91c1c; position: fixed; top: 0; left: 0; width: 100%; z-index: 9999; font-family: monospace; font-size: 0.9rem; }
    
    /* Loading Spinner */
    #pre-loader { display: flex; flex-direction: column; align-items: center; justify-content: center; height: 100vh; color: #64748b; }
    .spinner { width: 40px; height: 40px; border: 4px solid #e2e8f0; border-top-color: #3b82f6; border-radius: 50%; animation: spin 1s linear infinite; margin-bottom: 1rem; }
    @keyframes spin { to { transform: rotate(360deg); } }
  </style>

  <script type="importmap">
  {
    "imports": {
      "react": "https://esm.sh/react@18.2.0",
      "react-dom/client": "https://esm.sh/react-dom@18.2.0/client",
      "lucide-react": "https://esm.sh/lucide-react@0.294.0",
      "htm": "https://esm.sh/htm@3.1.1"
    }
  }
  </script>

  <script>
    window.onerror = function(msg, url, line, col, error) {
      const banner = document.getElementById('error-banner');
      const loader = document.getElementById('pre-loader');
      if (loader) loader.style.display = 'none';
      if (banner) {
        banner.style.display = 'block';
        banner.innerHTML = `<strong>Lỗi Hệ Thống:</strong> ${msg}<br><small>${url}:${line}:${col}</small>`;
      }
      return false;
    };
  </script>
</head>
<body>
  <div id="error-banner"></div>

  <div id="pre-loader">
    <div class="spinner"></div>
    <p>Đang khởi tạo dữ liệu báo giá...</p>
  </div>

  <div id="root"></div>

  <script type="module">
    import React, { useState, useEffect, useMemo } from 'react';
    import ReactDOM from 'react-dom/client';
    import { 
      Search, Calculator, FileText, Database, Check, Copy, Printer, ShieldCheck, Box, Info 
    } from 'lucide-react';
    import htm from 'htm';

    const html = htm.bind(React.createElement);

    // ==========================================
    // DỮ LIỆU BÁO GIÁ (CẬP NHẬT TỪ PDF 2026)
    // ==========================================
    const DATA_SOURCE = [
      // 1. GIA DỤNG (QCVN 9:2012)
      { category: "Gia dụng (QCVN 9)", product_name: "Điều hòa không khí (Thường)", price_vnd: 2000000, price_usd: 77, notes: "Chứng nhận Hợp quy" },
      { category: "Gia dụng (QCVN 9)", product_name: "Điều hòa Multi (1 mẹ 2 con)", price_vnd: 3000000, price_usd: 115, notes: "+1 mặt lạnh: +1.000.000 VNĐ" },
      { category: "Gia dụng (QCVN 9)", product_name: "Tủ lạnh / Tủ mát / Tủ đông", price_vnd: 2000000, price_usd: 77, notes: "" },
      { category: "Gia dụng (QCVN 9)", product_name: "Máy giặt gia dụng", price_vnd: 2000000, price_usd: 77, notes: "" },
      { category: "Gia dụng (QCVN 9)", product_name: "Máy sấy tóc / Máy xay / Máy ép", price_vnd: 2000000, price_usd: 77, notes: "Đồng giá các thiết bị gia dụng nhỏ" },
      { category: "Gia dụng (QCVN 9)", product_name: "Lò vi sóng / Bếp điện", price_vnd: 2000000, price_usd: 77, notes: "" },
      { category: "Gia dụng (QCVN 9)", product_name: "Bình nước nóng tức thời", price_vnd: 2000000, price_usd: 77, notes: "" },

      // 2. Ổ CẮM & DÂY (QCVN 4 & 25)
      { category: "Thiết bị điện", regulation: "QCVN 25:2025", product_name: "Ổ cắm / Phích cắm / Dây nguồn / Công tắc", price_vnd: 5000000, price_usd: 192, notes: "Phương thức 1 (Type test)" },
      { category: "Đánh giá nhà máy", regulation: "QCVN 4 & 25", product_name: "Đánh giá quá trình SX (Trong nước)", price_vnd: 30000000, price_usd: 1154, notes: "Giám sát: 15.000.000 VNĐ" },
      { category: "Đánh giá nhà máy", regulation: "QCVN 4 & 25", product_name: "Đánh giá quá trình SX (Nước ngoài)", price_vnd: 50000000, price_usd: 1923, notes: "Giám sát: 25.000.000 VNĐ" },
      { category: "Theo lô hàng", regulation: "QCVN 4:2009", product_name: "Lô hàng 1-5 model (Safety)", price_vnd: 3000000, price_usd: 115, notes: "" },
      { category: "Theo lô hàng", regulation: "QCVN 25:2025", product_name: "Lô hàng 1-5 model (Ổ cắm/Phích cắm)", price_vnd: 6000000, price_usd: 231, notes: "" },

      // 3. HIỆU SUẤT NĂNG LƯỢNG (VNEEP)
      { category: "VNEEP", regulation: "TCVN 7830", product_name: "Điều hòa Non-Inverter (<= 60k BTU)", price_vnd: 15000000, price_usd: 577, notes: "" },
      { category: "VNEEP", regulation: "TCVN 7830", product_name: "Điều hòa Inverter (<= 60k BTU)", price_vnd: 20000000, price_usd: 769, notes: "" },
      { category: "VNEEP", regulation: "TCVN 7828", product_name: "Tủ lạnh / Tủ đông (<= 500L)", price_vnd: 9000000, price_usd: 346, notes: ">500L: 11.000.000 VNĐ" },
      { category: "VNEEP", regulation: "TCVN 13372", product_name: "Bếp từ (1 vùng nấu)", price_vnd: 3000000, price_usd: 115, notes: "4 vùng nấu: 7.000.000 VNĐ" },
      { category: "VNEEP", regulation: "TCVN 7826", product_name: "Quạt điện (Bàn, đứng, tường)", price_vnd: 3000000, price_usd: 115, notes: "<50W: 2.000.000 VNĐ" },
      { category: "VNEEP", regulation: "TCVN 11843", product_name: "Đèn LED (<= 100W)", price_vnd: 4000000, price_usd: 153, notes: "" },
      { category: "VNEEP", regulation: "TCVN 8526", product_name: "Máy giặt (<= 10kg)", price_vnd: 4000000, price_usd: 154, notes: ">10kg: 5.000.000 VNĐ" },
      { category: "VNEEP", regulation: "TCVN 11848", product_name: "Laptop / Máy tính bảng", price_vnd: 3000000, price_usd: 115, notes: "" },
      { category: "VNEEP", regulation: "TCVN 9536", product_name: "Tivi (Máy thu hình)", price_vnd: 3500000, price_usd: 135, notes: "Có Auto Brightness: 4.500.000 VNĐ" },

      // 4. EMC (QCVN 9:2012)
      { category: "EMC", regulation: "QCVN 9:2012", product_name: "Điều hòa (1 chiều < 24000 BTU)", price_vnd: 13000000, price_usd: 500, notes: "" },
      { category: "EMC", regulation: "QCVN 9:2012", product_name: "Tủ lạnh / Tủ đông", price_vnd: 9000000, price_usd: 346, notes: "" },
      { category: "EMC", regulation: "QCVN 9:2012", product_name: "Lò vi sóng", price_vnd: 10000000, price_usd: 385, notes: "" },
      { category: "EMC", regulation: "QCVN 9:2012", product_name: "Bếp điện / Bếp từ (1 vùng)", price_vnd: 6000000, price_usd: 231, notes: "" },
      { category: "EMC", regulation: "QCVN 9:2012", product_name: "Máy giặt", price_vnd: 9000000, price_usd: 346, notes: "" },

      // 5. AN TOÀN ĐIỆN (SAFETY)
      { category: "Safety", regulation: "QCVN 4:2009", product_name: "Bình nóng lạnh / Ấm siêu tốc (Lần đầu)", price_vnd: 6000000, price_usd: 231, notes: "Lần 2 trở đi: 2.000.000 VNĐ" },
      { category: "Safety", regulation: "QCVN 4:2009", product_name: "Lò vi sóng (Lần đầu)", price_vnd: 8000000, price_usd: 308, notes: "" },
      { category: "Safety ICT", regulation: "QCVN 132:2022", product_name: "Thiết bị CNTT (Thân máy + 1 Adapter)", price_vnd: 23000000, price_usd: 885, notes: "IEC 62368-1:2018" },
      { category: "Safety ICT", regulation: "QCVN 132:2022", product_name: "Thiết bị chứa chất lỏng có áp suất", price_vnd: 20000000, price_usd: 769, notes: "Phụ phí cộng thêm" },

      // 6. THỬ NGHIỆM ĐÈN LED (QCVN 19)
      { category: "LED Testing", regulation: "QCVN 19:2019", product_name: "Trọn gói (Không IP)", price_vnd: 25000000, price_usd: 962, notes: "Gồm ES + EMI + EMS + PBS" },
      { category: "LED Testing", regulation: "QCVN 19:2019", product_name: "Trọn gói (Có IP)", price_vnd: 27000000, price_usd: 1038, notes: "Gồm ES + EMI + EMS + PBS + IP" },

      // 7. PIN LITHIUM (QCVN 101)
      { category: "Pin Lithium", regulation: "QCVN 101:2020", product_name: "Gói pin (Battery Pack)", price_vnd: 8000000, price_usd: 308, notes: "Yêu cầu 22 mẫu" },
      { category: "Pin Lithium", regulation: "QCVN 101:2020", product_name: "Tế bào pin (Battery Cell)", price_vnd: 8000000, price_usd: 308, notes: "Yêu cầu 38 mẫu" },
      { category: "Pin Lithium", regulation: "QCVN 101:2020", product_name: "Trọn gói (Pack + 1 Cell)", price_vnd: 16000000, price_usd: 615, notes: "" },

      // 8. VIỄN THÔNG & SAR (Giá trị cao)
      { category: "Viễn thông", regulation: "QCVN 134:2024", product_name: "Điện thoại 3G+4G (Không CA)", price_vnd: 860000000, price_usd: 33000, notes: "Thử nghiệm SAR. Miễn phí QCVN 117" },
      { category: "Viễn thông", regulation: "QCVN 134:2024", product_name: "Điện thoại 3G+4G (Có CA/MIMO)", price_vnd: 1040000000, price_usd: 40000, notes: "Thử nghiệm SAR. Miễn phí QCVN 117" },
      { category: "Viễn thông", regulation: "QCVN 134:2024", product_name: "Điện thoại 5G (Full)", price_vnd: 1300000000, price_usd: 50000, notes: "Thử nghiệm SAR. Giảm 20% phí thử" },
      { category: "Viễn thông", regulation: "QCVN 134:2024", product_name: "Tablet / Laptop (Chỉ Wifi)", price_vnd: 290000000, price_usd: 11150, notes: "Thử nghiệm SAR. Miễn phí QCVN 54/65" },
      { category: "Viễn thông", regulation: "QCVN 117:2023", product_name: "Thiết bị 4G LTE (Điều kiện thường)", price_vnd: 18000000, price_usd: 692, notes: "" },
      { category: "Viễn thông", regulation: "QCVN 54/65", product_name: "Thiết bị Wifi", price_vnd: 7000000, price_usd: 269, notes: "" },
      { category: "Viễn thông", regulation: "QCVN 136:2025", product_name: "Thử nghiệm QCVN 136", price_vnd: 25000000, price_usd: 962, notes: "Quy chuẩn mới 2025" }
    ];

    // ==========================================
    // UI COMPONENTS
    // ==========================================
    const NavItem = ({ icon, label, active, onClick }) => html`
      <button 
        onClick=${onClick}
        className=${`flex w-full items-center gap-3 px-4 py-3 rounded-xl transition-all ${active ? 'bg-blue-600 text-white font-bold shadow-md' : 'text-slate-500 hover:bg-slate-100 hover:text-slate-900'}`}
      >
        <${icon} size=${18} />
        <span className="text-sm text-left flex-1">${label}</span>
      </button>
    `;

    const PricingCard = ({ item, isCopied, onCopy }) => html`
      <div className="bg-white rounded-2xl border border-slate-200 shadow-sm hover:shadow-lg transition-all p-6 break-inside-avoid animate-fadeIn">
        <div className="flex flex-col md:flex-row justify-between items-start gap-4 mb-4">
          <div>
            <span className="inline-block px-2 py-1 bg-slate-100 text-slate-600 text-xs font-bold uppercase rounded mb-2">
              ${item.category}
            </span>
            <h3 className="text-lg font-bold text-slate-800 leading-tight">${item.product_name}</h3>
            <p className="text-sm text-slate-500 mt-1 flex items-center gap-1">
              <${FileText} size=${12} /> ${item.regulation}
            </p>
          </div>
          <div className="text-right">
            <div className="text-2xl font-black text-blue-600">
              ${item.price_vnd.toLocaleString('vi-VN')}
            </div>
            <div className="text-xs font-bold text-slate-400">VNĐ</div>
          </div>
        </div>

        <div className="pt-4 border-t border-slate-100 flex flex-col gap-2">
          ${item.notes && html`
            <div className="text-sm text-slate-600 bg-blue-50 p-3 rounded-lg italic border border-blue-100">
              "${item.notes}"
            </div>
          `}
          
          <div className="flex justify-between items-center mt-2 pt-2">
            <span className="text-xs text-slate-400 font-mono">ID: ${item.price_usd}USD</span>
            <button
              onClick=${onCopy}
              className=${`flex items-center gap-1 text-xs font-bold px-3 py-1.5 rounded-full border transition-all ${isCopied ? 'bg-green-50 border-green-200 text-green-600' : 'bg-white border-slate-200 text-slate-500 hover:bg-slate-50'}`}
            >
              <${isCopied ? Check : Copy} size=${12} />
              ${isCopied ? 'Đã chép' : 'Sao chép'}
            </button>
          </div>
        </div>
      </div>
    `;

    const App = () => {
      const [query, setQuery] = useState('');
      const [activeTab, setActiveTab] = useState('search');
      const [copiedIndex, setCopiedIndex] = useState(null);

      // Tắt pre-loader khi React mount thành công
      useEffect(() => {
        const loader = document.getElementById('pre-loader');
        if (loader) loader.style.display = 'none';
      }, []);

      // Logic tìm kiếm an toàn
      const results = useMemo(() => {
        if (!query.trim()) return [];
        const term = query.toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g, "");
        return DATA_SOURCE.filter(item => {
          const content = `${item.product_name} ${item.regulation} ${item.category} ${item.notes}`
            .toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g, "");
          return content.includes(term);
        });
      }, [query]);

      const handleCopy = (item, idx) => {
        const text = `Báo giá PGL 2026\nSản phẩm: ${item.product_name}\nQuy chuẩn: ${item.regulation}\nGiá: ${item.price_vnd.toLocaleString('vi-VN')} VNĐ`;
        navigator.clipboard.writeText(text);
        setCopiedIndex(idx);
        setTimeout(() => setCopiedIndex(null), 2000);
      };

      return html`
        <div className="flex flex-col md:flex-row min-h-screen">
          <aside className="w-full md:w-64 bg-white border-r border-slate-200 p-6 flex flex-col gap-6 md:fixed md:h-full z-20 no-print">
            <div className="flex items-center gap-3">
              <div className="w-10 h-10 bg-blue-600 rounded-lg flex items-center justify-center text-white shadow-lg">
                <${Calculator} size=${24} />
              </div>
              <div>
                <h1 className="font-bold text-lg text-slate-800">PGL Pricing</h1>
                <p className="text-xs text-slate-500">Offline v3.0 (Safe Mode)</p>
              </div>
            </div>

            <nav className="flex flex-col gap-2">
              <${NavItem} icon=${Search} label="Tra cứu báo giá" active=${activeTab === 'search'} onClick=${() => setActiveTab('search')} />
              <${NavItem} icon=${Database} label="Dữ liệu gốc" active=${activeTab === 'data'} onClick=${() => setActiveTab('data')} />
            </nav>

            <div className="mt-auto bg-slate-50 p-4 rounded-xl border border-slate-100 text-xs text-slate-500">
              <p className="font-bold text-slate-700 mb-1">Trạng thái dữ liệu</p>
              <div className="flex items-center gap-2">
                <div className="w-2 h-2 rounded-full bg-green-500"></div>
                <span>Sẵn sàng (Offline)</span>
              </div>
              <p className="mt-2 pt-2 border-t border-slate-200">Cập nhật: 20/01/2026</p>
            </div>
          </aside>

          <main className="flex-1 md:ml-64 p-4 md:p-8">
            ${activeTab === 'search' ? html`
              <div className="max-w-4xl mx-auto animate-fadeIn">
                <div className="text-center md:text-left mb-8 no-print">
                  <h1 className="text-3xl font-extrabold text-slate-800 mb-2">Tra cứu dịch vụ</h1>
                  <p className="text-slate-500">Nhập tên thiết bị (ví dụ: "điều hòa", "pin", "QCVN 134")</p>
                  
                  <div className="mt-6 relative group">
                    <${Search} className="absolute left-4 top-1/2 -translate-y-1/2 text-slate-400 group-focus-within:text-blue-500" size=${20} />
                    <input 
                      type="text" 
                      className="w-full pl-12 pr-4 py-4 bg-white border-2 border-slate-200 rounded-2xl focus:border-blue-500 focus:outline-none focus:shadow-lg transition-all text-lg"
                      placeholder="Tìm kiếm..."
                      value=${query}
                      onChange=${e => setQuery(e.target.value)}
                      autoFocus
                    />
                  </div>
                </div>

                <div className="hidden print-only text-center border-b pb-4 mb-6">
                  <h2 className="text-2xl font-bold">BÁO GIÁ DỊCH VỤ THỬ NGHIỆM PGL</h2>
                  <p>Ngày: ${new Date().toLocaleDateString('vi-VN')}</p>
                </div>

                <div className="space-y-6 pb-20">
                  ${query && results.length === 0 && html`
                    <div className="text-center py-20 bg-white rounded-3xl border-dashed border-2 border-slate-200">
                      <${Box} size=${48} className="mx-auto text-slate-300 mb-4" />
                      <p className="text-slate-500 font-medium">Không tìm thấy kết quả phù hợp</p>
                    </div>
                  `}

                  ${results.length > 0 && html`
                     <div className="flex justify-between items-center mb-2 no-print">
                       <span className="text-sm font-bold text-slate-400 uppercase">Kết quả (${results.length})</span>
                       <button onClick=${() => window.print()} className="flex items-center gap-2 text-sm text-blue-600 font-bold hover:bg-blue-50 px-3 py-1 rounded-lg transition-colors">
                         <${Printer} size=${16} /> In báo giá
                       </button>
                     </div>
                  `}

                  <div className="grid grid-cols-1 gap-4">
                    ${results.map((item, idx) => html`
                      <${PricingCard} 
                        key=${idx} 
                        item=${item} 
                        isCopied=${copiedIndex === idx}
                        onCopy=${() => handleCopy(item, idx)}
                      />
                    `)}
                  </div>
                </div>
              </div>
            ` : html`
              <div className="max-w-4xl mx-auto animate-fadeIn">
                <h2 className="text-2xl font-bold text-slate-800 mb-6 flex items-center gap-2">
                  <${Database} size=${24} /> Dữ liệu thô
                </h2>
                <div className="bg-slate-900 text-slate-300 p-6 rounded-2xl overflow-x-auto shadow-inner font-mono text-xs leading-relaxed">
                  ${JSON.stringify(DATA_SOURCE, null, 2)}
                </div>
              </div>
            `}
          </main>
        </div>
      `;
    };

    // Mount App
    const root = ReactDOM.createRoot(document.getElementById('root'));
    root.render(html`<${App} />`);
  </script>
</body>
</html>
