<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>PGL Pricing Assistant v4.0 (Cart Enabled)</title>
  
  <script src="https://cdn.tailwindcss.com"></script>
  
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
  
  <style>
    body { font-family: 'Inter', sans-serif; background-color: #f8fafc; }
    .animate-fadeIn { animation: fadeIn 0.3s ease-out forwards; }
    @keyframes fadeIn { from { opacity: 0; transform: translateY(5px); } to { opacity: 1; transform: translateY(0); } }
    
    /* Scrollbar */
    ::-webkit-scrollbar { width: 6px; height: 6px; }
    ::-webkit-scrollbar-track { background: transparent; }
    ::-webkit-scrollbar-thumb { background: #cbd5e1; border-radius: 3px; }
    
    /* Print Styles */
    @media print {
      body { background: white; }
      aside, .no-print { display: none !important; }
      main { margin: 0; padding: 0; }
      .print-only { display: block !important; }
      .card { break-inside: avoid; border: 1px solid #ddd; box-shadow: none; }
    }
  </style>

  <script type="importmap">
  {
    "imports": {
      "react": "https://esm.sh/react@18.2.0",
      "react-dom/client": "https://esm.sh/react-dom@18.2.0/client",
      "lucide-react": "https://esm.sh/lucide-react@0.294.0",
      "htm": "https://esm.sh/htm@3.1.1"
    }
  }
  </script>
</head>
<body>
  <div id="root"></div>

  <script type="module">
    import React, { useState, useMemo, useEffect } from 'react';
    import ReactDOM from 'react-dom/client';
    import { 
      Search, Calculator, ShoppingCart, Trash2, Plus, Printer, 
      FileText, Database, ShieldCheck, Wifi, Cpu, X
    } from 'lucide-react';
    import htm from 'htm';

    const html = htm.bind(React.createElement);

    // ==========================================
    // DỮ LIỆU BÁO GIÁ (FULL DATA 2026)
    // ==========================================
    const DATA_SOURCE = [
      // --- VIỄN THÔNG & CNTT (NEW UPDATE) ---
      { category: "Viễn thông", regulation: "QCVN 47:2015", product_name: "Thiết bị vô tuyến (P <= 1W)", price_vnd: 8000000, price_usd: 308, notes: "Đo giả mạo (Spurious)" },
      { category: "Viễn thông", regulation: "QCVN 47:2015", product_name: "Thiết bị vô tuyến (1W < P <= 5W)", price_vnd: 10000000, price_usd: 385, notes: "" },
      { category: "Viễn thông", regulation: "QCVN 54:2020", product_name: "Thiết bị Wifi 2.4GHz (Đk thường)", price_vnd: 7000000, price_usd: 269, notes: "Bổ sung điều kiện tới hạn: +3.000.000 VNĐ" },
      { category: "Viễn thông", regulation: "QCVN 65:2021", product_name: "Thiết bị Wifi 5GHz (Đk thường)", price_vnd: 7000000, price_usd: 269, notes: "Access Point / Device" },
      { category: "Viễn thông", regulation: "QCVN 117:2023", product_name: "Thiết bị 4G LTE (1 công nghệ)", price_vnd: 18000000, price_usd: 692, notes: "Điều kiện thường" },
      { category: "Viễn thông", regulation: "QCVN 117:2023", product_name: "Thiết bị 4G LTE (Thường + Tới hạn)", price_vnd: 26000000, price_usd: 1000, notes: "Full điều kiện" },
      { category: "Viễn thông", regulation: "QCVN 117:2023", product_name: "Thiết bị 2G/3G (GSM/WCDMA)", price_vnd: 12000000, price_usd: 461, notes: "Điều kiện thường" },
      { category: "Viễn thông", regulation: "QCVN 18:2022", product_name: "EMC cho thiết bị 5G", price_vnd: 7000000, price_usd: 269, notes: "Tương thích điện từ" },
      { category: "Viễn thông", regulation: "QCVN 136:2025", product_name: "Quy chuẩn kỹ thuật mới 2025", price_vnd: 25000000, price_usd: 962, notes: "Áp dụng thiết bị đặc thù" },
      { category: "Viễn thông", regulation: "QCVN 112:2017", product_name: "Thiết bị LPI (Low Power)", price_vnd: 5000000, price_usd: 192, notes: "Thiết bị tầm ngắn" },
      { category: "Viễn thông", regulation: "QCVN 86:2019", product_name: "EMC thiết bị thông tin di động", price_vnd: 6000000, price_usd: 231, notes: "1 công nghệ" },
      { category: "Viễn thông", regulation: "QCVN 118:2018", product_name: "EMC thiết bị đa phương tiện (MME)", price_vnd: 5000000, price_usd: 192, notes: "Thay thế TCVN 7189" },
      { category: "Viễn thông", regulation: "QCVN 119:2019", product_name: "Thiết bị Hàng hải/Radar", price_vnd: 8000000, price_usd: 308, notes: "" },
      { category: "Viễn thông", regulation: "QCVN 103:2016", product_name: "Thiết bị RFID", price_vnd: 7000000, price_usd: 269, notes: "" },
      
      // --- SAR (QCVN 134:2024) ---
      { category: "SAR Testing", regulation: "QCVN 134:2024", product_name: "Điện thoại 3G+4G (Non-CA)", price_vnd: 860000000, price_usd: 33000, notes: "Đo mức hấp thụ riêng (SAR). Miễn phí QCVN 117." },
      { category: "SAR Testing", regulation: "QCVN 134:2024", product_name: "Điện thoại 3G+4G (Có CA/MIMO)", price_vnd: 1040000000, price_usd: 40000, notes: "Đo mức hấp thụ riêng (SAR). Miễn phí QCVN 117." },
      { category: "SAR Testing", regulation: "QCVN 134:2024", product_name: "Điện thoại 5G (Full Option)", price_vnd: 1300000000, price_usd: 50000, notes: "Đo SAR 5G. Giảm 20% phí thử nghiệm." },
      { category: "SAR Testing", regulation: "QCVN 134:2024", product_name: "Tablet/Laptop (Chỉ Wifi)", price_vnd: 290000000, price_usd: 11150, notes: "Đo SAR Wifi. Miễn phí QCVN 54/65." },
      { category: "SAR Testing", regulation: "QCVN 134:2024", product_name: "Tablet/Laptop (3G/4G Non-CA)", price_vnd: 580000000, price_usd: 22300, notes: "Đo SAR." },

      // --- GIA DỤNG (QCVN 9:2012) ---
      { category: "Gia dụng", regulation: "QCVN 9:2012", product_name: "Điều hòa không khí (Thường)", price_vnd: 2000000, price_usd: 77, notes: "Chứng nhận HQ" },
      { category: "Gia dụng", regulation: "QCVN 9:2012", product_name: "Tủ lạnh / Tủ mát", price_vnd: 2000000, price_usd: 77, notes: "Chứng nhận HQ" },
      { category: "Gia dụng", regulation: "QCVN 9:2012", product_name: "Máy giặt", price_vnd: 2000000, price_usd: 77, notes: "Chứng nhận HQ" },
      { category: "Gia dụng", regulation: "QCVN 9:2012", product_name: "Máy sấy tóc / Máy xay / Máy ép", price_vnd: 2000000, price_usd: 77, notes: "Đồng giá gia dụng nhỏ" },
      { category: "Gia dụng", regulation: "QCVN 9:2012", product_name: "Lò vi sóng", price_vnd: 2000000, price_usd: 77, notes: "Chứng nhận HQ" },

      // --- AN TOÀN & Ổ CẮM ---
      { category: "Thiết bị điện", regulation: "QCVN 25:2025", product_name: "Ổ cắm / Phích cắm (Hợp quy)", price_vnd: 5000000, price_usd: 192, notes: "Phương thức 1" },
      { category: "Safety", regulation: "QCVN 4:2009", product_name: "Bình nóng lạnh (Safety)", price_vnd: 6000000, price_usd: 231, notes: "Thử nghiệm Lần đầu" },
      { category: "Safety ICT", regulation: "QCVN 132:2022", product_name: "Thiết bị CNTT (Adaptor rời)", price_vnd: 23000000, price_usd: 885, notes: "IEC 62368" },

      // --- HIỆU SUẤT NĂNG LƯỢNG ---
      { category: "VNEEP", regulation: "TCVN 7830", product_name: "Điều hòa Inverter (<= 60k BTU)", price_vnd: 20000000, price_usd: 769, notes: "Thử nghiệm HSNL" },
      { category: "VNEEP", regulation: "TCVN 7828", product_name: "Tủ lạnh (<= 500L)", price_vnd: 9000000, price_usd: 346, notes: "Thử nghiệm HSNL" },
      
      // --- PIN LITHIUM ---
      { category: "Pin Lithium", regulation: "QCVN 101:2020", product_name: "Pin Lithium (Trọn gói Pack+Cell)", price_vnd: 16000000, price_usd: 615, notes: "Cần 22 Pack + 16 Cell" }
    ];

    // ==========================================
    // UI COMPONENTS
    // ==========================================
    
    // Nút điều hướng trái
    const NavItem = ({ icon, label, count, active, onClick }) => html`
      <button 
        onClick=${onClick}
        className=${`flex w-full items-center gap-3 px-4 py-3 rounded-xl transition-all relative ${active ? 'bg-blue-600 text-white font-bold shadow-md' : 'text-slate-500 hover:bg-slate-100 hover:text-slate-900'}`}
      >
        <${icon} size=${18} />
        <span className="text-sm text-left flex-1">${label}</span>
        ${count > 0 && html`
          <span className="bg-red-500 text-white text-[10px] font-bold px-2 py-0.5 rounded-full shadow-sm">
            ${count}
          </span>
        `}
      </button>
    `;

    // Thẻ sản phẩm
    const PricingCard = ({ item, onAdd }) => html`
      <div className="bg-white rounded-xl border border-slate-200 p-5 hover:shadow-lg transition-all animate-fadeIn group relative">
        <div className="flex justify-between items-start mb-2">
          <span className="inline-block px-2 py-0.5 bg-slate-100 text-slate-600 text-[10px] font-bold uppercase rounded tracking-wider">
            ${item.category}
          </span>
          <button 
            onClick=${() => onAdd(item)}
            className="text-blue-600 bg-blue-50 p-2 rounded-full hover:bg-blue-600 hover:text-white transition-colors"
            title="Thêm vào giỏ"
          >
            <${Plus} size=${18} />
          </button>
        </div>
        
        <h3 className="text-base font-bold text-slate-800 mb-1 line-clamp-2" title=${item.product_name}>
          ${item.product_name}
        </h3>
        
        <div className="flex items-center gap-2 text-xs text-slate-500 mb-4">
          <${ShieldCheck} size=${12} className="text-green-500" /> 
          <span className="font-mono bg-slate-50 px-1 rounded">${item.regulation}</span>
        </div>

        <div className="flex items-end justify-between border-t border-slate-50 pt-3">
          <div className="text-xs text-slate-400 italic max-w-[60%] line-clamp-1">
            ${item.notes || "Tiêu chuẩn"}
          </div>
          <div className="text-right">
            <div className="text-lg font-black text-blue-600">
              ${(item.price_vnd / 1000000).toLocaleString('vi-VN')} Tr
            </div>
            <div className="text-[10px] text-slate-400">VNĐ</div>
          </div>
        </div>
      </div>
    `;

    // App Chính
    const App = () => {
      const [activeTab, setActiveTab] = useState('search');
      const [query, setQuery] = useState('');
      const [cart, setCart] = useState([]);
      
      // Logic Tìm kiếm: Product Name hoặc Regulation
      const results = useMemo(() => {
        if (!query.trim()) return DATA_SOURCE;
        const term = query.toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g, "");
        return DATA_SOURCE.filter(item => {
          const content = `${item.product_name} ${item.regulation} ${item.category}`
            .toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g, "");
          return content.includes(term);
        });
      }, [query]);

      // Logic Giỏ hàng
      const addToCart = (item) => {
        setCart(prev => [...prev, item]);
      };

      const removeFromCart = (index) => {
        setCart(prev => prev.filter((_, i) => i !== index));
      };

      const clearCart = () => setCart([]);

      const totalVND = cart.reduce((sum, item) => sum + item.price_vnd, 0);
      const totalUSD = cart.reduce((sum, item) => sum + item.price_usd, 0);

      return html`
        <div className="flex flex-col md:flex-row h-screen overflow-hidden bg-slate-50">
          
          <aside className="w-full md:w-64 bg-white border-r border-slate-200 flex flex-col z-20 shadow-sm no-print">
            <div className="p-6">
              <div className="flex items-center gap-3 mb-8">
                <div className="w-10 h-10 bg-blue-600 rounded-xl flex items-center justify-center text-white shadow-lg shadow-blue-200">
                  <${Calculator} size=${24} />
                </div>
                <div>
                  <h1 className="font-bold text-lg text-slate-800 tracking-tight">PGL Quote</h1>
                  <p className="text-[10px] text-slate-500 font-medium">Pricing Assistant v4.0</p>
                </div>
              </div>

              <nav className="flex flex-col gap-2">
                <${NavItem} icon=${Search} label="Tra cứu & Chọn" active=${activeTab === 'search'} onClick=${() => setActiveTab('search')} />
                <${NavItem} icon=${ShoppingCart} label="Giỏ hàng báo giá" count=${cart.length} active=${activeTab === 'cart'} onClick=${() => setActiveTab('cart')} />
                <${NavItem} icon=${Database} label="Dữ liệu gốc" active=${activeTab === 'data'} onClick=${() => setActiveTab('data')} />
              </nav>
            </div>

            <div className="mt-auto p-4 bg-slate-50 border-t border-slate-100">
              <div className="text-xs font-medium text-slate-500 mb-2">Tổng tạm tính:</div>
              <div className="text-xl font-black text-blue-600 truncate">
                ${totalVND.toLocaleString('vi-VN')} <span className="text-xs text-slate-400 font-normal">VNĐ</span>
              </div>
            </div>
          </aside>

          <main className="flex-1 flex flex-col h-full overflow-hidden relative">
            
            ${activeTab === 'search' && html`
              <div className="flex flex-col h-full">
                <div className="bg-white border-b border-slate-200 p-4 md:p-6 shadow-sm z-10">
                  <div className="max-w-3xl mx-auto w-full">
                    <h2 className="text-xl font-bold text-slate-800 mb-4">Tra cứu dịch vụ</h2>
                    <div className="relative group">
                      <${Search} className="absolute left-4 top-1/2 -translate-y-1/2 text-slate-400 group-focus-within:text-blue-500" size=${20} />
                      <input 
                        type="text" 
                        className="w-full pl-12 pr-4 py-3 bg-slate-50 border border-slate-200 rounded-xl focus:bg-white focus:border-blue-500 focus:ring-4 focus:ring-blue-50 transition-all outline-none text-slate-800 placeholder:text-slate-400"
                        placeholder="Tìm tên thiết bị (Wifi, 4G) hoặc QCVN (117, 134)..."
                        value=${query}
                        onChange=${e => setQuery(e.target.value)}
                        autoFocus
                      />
                      ${query && html`
                        <button onClick=${() => setQuery('')} className="absolute right-4 top-1/2 -translate-y-1/2 text-slate-400 hover:text-slate-600">
                          <${X} size=${16} />
                        </button>
                      `}
                    </div>
                  </div>
                </div>

                <div className="flex-1 overflow-y-auto p-4 md:p-6 bg-slate-50/50">
                  <div className="max-w-5xl mx-auto">
                    <div className="flex items-center justify-between mb-4">
                      <span className="text-xs font-bold text-slate-400 uppercase tracking-wider">
                        ${query ? `Tìm thấy ${results.length} kết quả` : 'Tất cả dịch vụ'}
                      </span>
                    </div>

                    ${results.length === 0 ? html`
                      <div className="flex flex-col items-center justify-center py-20 opacity-50">
                         <${Database} size=${48} className="mb-4 text-slate-300"/>
                         <p>Không tìm thấy kết quả nào</p>
                      </div>
                    ` : html`
                      <div className="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-4">
                        ${results.map((item, idx) => html`
                          <${PricingCard} key=${idx} item=${item} onAdd=${addToCart} />
                        `)}
                      </div>
                    `}
                  </div>
                </div>
              </div>
            `}

            ${activeTab === 'cart' && html`
              <div className="flex flex-col h-full bg-white animate-fadeIn">
                <div className="p-6 border-b border-slate-200 flex justify-between items-center no-print">
                  <div>
                    <h2 className="text-2xl font-bold text-slate-800">Bảng kê báo giá</h2>
                    <p className="text-sm text-slate-500">Danh sách các hạng mục đã chọn</p>
                  </div>
                  <div className="flex gap-3">
                    <button 
                      onClick=${clearCart}
                      disabled=${cart.length === 0}
                      className="px-4 py-2 text-red-600 bg-red-50 hover:bg-red-100 rounded-lg font-medium text-sm disabled:opacity-50 transition-colors"
                    >
                      Xóa tất cả
                    </button>
                    <button 
                      onClick=${() => window.print()}
                      disabled=${cart.length === 0}
                      className="px-4 py-2 bg-blue-600 text-white hover:bg-blue-700 rounded-lg font-bold text-sm shadow-lg shadow-blue-200 flex items-center gap-2 transition-all disabled:opacity-50 disabled:shadow-none"
                    >
                      <${Printer} size=${16} /> In Báo giá
                    </button>
                  </div>
                </div>

                <div className="flex-1 overflow-y-auto p-6 md:p-8 print:p-0 print:overflow-visible">
                  <div className="max-w-4xl mx-auto bg-white print:w-full">
                    
                    <div className="hidden print-only mb-8 border-b pb-4">
                      <div className="flex justify-between items-start">
                        <div>
                          <h1 className="text-2xl font-bold uppercase text-slate-900">Bảng Tổng Hợp Báo Giá</h1>
                          <p className="text-sm text-slate-600 mt-1">Phòng Thử nghiệm Phúc Gia (PGL)</p>
                        </div>
                        <div className="text-right">
                          <p className="text-sm text-slate-500">Ngày: ${new Date().toLocaleDateString('vi-VN')}</p>
                        </div>
                      </div>
                    </div>

                    ${cart.length === 0 ? html`
                      <div className="text-center py-20 border-2 border-dashed border-slate-200 rounded-2xl no-print">
                        <${ShoppingCart} size=${64} className="mx-auto text-slate-200 mb-4" />
                        <h3 className="text-lg font-bold text-slate-600">Giỏ hàng trống</h3>
                        <p className="text-slate-400 mb-6">Vui lòng chọn dịch vụ từ tab Tra cứu</p>
                        <button onClick=${() => setActiveTab('search')} className="px-6 py-2 bg-slate-800 text-white rounded-lg hover:bg-slate-700 transition-colors">
                          Quay lại Tra cứu
                        </button>
                      </div>
                    ` : html`
                      <table className="w-full text-left border-collapse">
                        <thead>
                          <tr className="border-b-2 border-slate-800 text-slate-800 text-sm">
                            <th className="py-3 font-bold w-12 text-center">STT</th>
                            <th className="py-3 font-bold">Nội dung / Quy chuẩn</th>
                            <th className="py-3 font-bold text-right w-40">Đơn giá (VNĐ)</th>
                            <th className="py-3 font-bold text-center w-12 no-print">Xóa</th>
                          </tr>
                        </thead>
                        <tbody className="text-sm text-slate-700 divide-y divide-slate-100">
                          ${cart.map((item, idx) => html`
                            <tr key=${idx} className="group hover:bg-slate-50">
                              <td className="py-4 text-center text-slate-400">${idx + 1}</td>
                              <td className="py-4">
                                <div className="font-bold text-slate-900">${item.product_name}</div>
                                <div className="text-xs text-slate-500 mt-1 flex gap-2">
                                  <span className="bg-slate-100 px-1.5 rounded border border-slate-200">${item.regulation}</span>
                                  <span className="italic text-slate-400">${item.notes}</span>
                                </div>
                              </td>
                              <td className="py-4 text-right font-mono font-medium">
                                ${item.price_vnd.toLocaleString('vi-VN')}
                              </td>
                              <td className="py-4 text-center no-print">
                                <button 
                                  onClick=${() => removeFromCart(idx)}
                                  className="text-slate-300 hover:text-red-500 transition-colors p-1"
                                >
                                  <${Trash2} size=${16} />
                                </button>
                              </td>
                            </tr>
                          `)}
                        </tbody>
                        <tfoot className="border-t-2 border-slate-800 font-bold text-slate-900">
                          <tr>
                            <td colspan="2" className="py-4 text-right pr-4 uppercase">Tổng cộng</td>
                            <td className="py-4 text-right text-lg">
                              ${totalVND.toLocaleString('vi-VN')}
                            </td>
                            <td className="no-print"></td>
                          </tr>
                          <tr className="text-slate-500 text-xs font-normal">
                            <td colspan="2" className="py-1 text-right pr-4 italic">Tương đương USD</td>
                            <td className="py-1 text-right font-mono">
                              $${totalUSD.toLocaleString('en-US')}
                            </td>
                            <td className="no-print"></td>
                          </tr>
                        </tfoot>
                      </table>
                      
                      <div className="mt-8 pt-4 border-t border-slate-200 text-xs text-slate-500 italic print-only">
                        <p>* Báo giá trên chưa bao gồm VAT (5%).</p>
                        <p>* Giá trị báo giá có hiệu lực trong vòng 30 ngày.</p>
                      </div>
                    `}
                  </div>
                </div>
              </div>
            `}

            ${activeTab === 'data' && html`
              <div className="flex-1 overflow-auto p-6 bg-slate-900 text-slate-300 font-mono text-xs">
                <pre>${JSON.stringify(DATA_SOURCE, null, 2)}</pre>
              </div>
            `}

          </main>
        </div>
      `;
    };

    const root = ReactDOM.createRoot(document.getElementById('root'));
    root.render(html`<${App} />`);
  </script>
</body>
</html>
